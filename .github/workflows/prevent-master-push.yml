name: Prevent Direct Push to Master

on: push

jobs:
  block-direct-push:
    runs-on: ubuntu-latest
    steps:
      - name: Check if push is to master
        run: |
          BRANCH_NAME=${GITHUB_REF#refs/heads/}
          COMMIT_MESSAGE=$(git log -1 --pretty=%B)

          if [[ "$BRANCH_NAME" == "master" || "$BRANCH_NAME" == "main" ]]; then
            if [[ "$COMMIT_MESSAGE" == *"Merge pull request"* ]]; then
              echo "âœ… This is a merge commit from a PR. Allowed."
              exit 0
            fi

            echo "ðŸš¨ Direct pushes to $BRANCH_NAME are not allowed! Use a pull request instead."
            exit 1
          fi
